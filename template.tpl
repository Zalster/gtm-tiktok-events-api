___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "TikTok Events API Tag",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "A server-side tag template to parse GA4 client requests to TikTok Events API request.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "general",
    "displayName": "General Settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "pixelCode",
        "displayName": "Pixel Code",
        "simpleValueType": true,
        "alwaysInSummary": false
      },
      {
        "type": "TEXT",
        "name": "accessToken",
        "displayName": "Access Token",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "other",
    "displayName": "Other Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SELECT",
        "name": "purchaseEvent",
        "displayName": "Map GA4 Purchase event",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "PlaceAnOrder",
            "displayValue": "Place An Order (Default)"
          },
          {
            "value": "CompletePayment",
            "displayValue": "Complete Payment (Other services)"
          }
        ],
        "simpleValueType": true,
        "help": "\u003cb\u003e\u003cu\u003eGA4 Purchase Event\u003c/u\u003e\u003c/b\u003e\u003cbr\u003e Select which TikTok event to map with when the purchase event is triggered in the GA4 Client\u003cbr\u003e\n\u003cb\u003ePlace An Order\u003c/b\u003e\u003cbr\u003e\nWhen a visitor places an order. This is considered a type of purchase event. We suggest using this purchase event type if the visitor is paying for goods or items. \u003cbr\u003e\n\u003cb\u003eCompletePayment\u003c/b\u003e\u003cbr\u003eWhen a visitor makes a payment. This is considered a type of purchase event. We suggest using this purchase event type if the visitor is paying for a service.",
        "alwaysInSummary": false,
        "defaultValue": "PlaceAnOrder"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

// GTM JS Libraries
const getAllEventData = require('getAllEventData');
const getCookieValues = require('getCookieValues');
const getRemoteAddress = require('getRemoteAddress');
const getTimestampMillis = require('getTimestampMillis');
const getType= require('getType');
const JSON = require('JSON');
const logToConsole = require('logToConsole');
const Math = require('Math');
const makeString = require('makeString');
const makeInteger = require('makeInteger');
const makeNumber = require('makeNumber');
const sendHttpRequest = require('sendHttpRequest');
const setCookie = require('setCookie');
const sha256Sync = require('sha256Sync');

// GA4 Events map
const ga4Events = {
  "page_view": "PageView",
  "view_item": "ViewContent",
  "click": "ClickButton",
  "search": "Search",
  "add_to_cart": "AddToCart",
  "add_to_wishlist": "AddToWishlist",
  "begin_checkout": "InitiateCheckout",
  "add_payment_info": "AddPaymentInfo",
  "purchase": data.purchaseEvent,
  "contact": "Contact",
  "download": "Download",
  "file_download": "Download",
  "generate_lead": "SubmitForm",
  "complete_registration": "CompleteRegistration",
  "subscribe": 'Subscribe'
};

// helper functions
const getEventName = (eventName) => {
  if (ga4Events.hasOwnProperty(eventName)) {
    return ga4Events[eventName];
  }
  return eventName;
};

const hashSHA256 = (value) => {
  if (!value) {
    return value;
  }
  
  if (value.match('^[A-Fa-f0-9]{64}$') !== null) {
    return value;
  }
  
  return sha256Sync(value, {outputEncoding: 'hex'});
};

const getTtclidFromUrl = (pageUrl) => {   
  if (pageUrl.indexOf('ttclid') !== -1) {
    return pageUrl.split("ttclid=")[1].split("&")[0];
  }
  return undefined;
};

const getTtqContentsFromItems = (items) => {
  if (items.length === 0) return;
  return items.map((item) => {
    let item_id = item.item_id || item.id;
    let content = {
      "content_id": makeString(item_id),
      "quantity": makeInteger(item.quantity),
      "price": makeNumber(item.price)
    };
    if (item.hasOwnProperty("item_category")) {
      content.content_type = item.item_category;
    }
    if (item.hasOwnProperty("content_type")) {
      content.content_type = item.content_type;
    }
    return content;
  });
};

const getValueFromItems = (items) => {
  if (items.length === 0) return;
  const reducer = (previousValue, currentValue) => previousValue + currentValue;
  return Math.round(items.map((item) => {
    return makeInteger(item.quantity) * makeNumber(item.price); 
  }).reduce(reducer) * 100) / 100;
};

const generateGA4EventId = (eventData) => {
  if (!eventData.hasOwnProperty("ga_session_id")) return;
  return [
    hashSHA256(eventData.ga_session_id),
    makeString(getTimestampMillis())
  ].join('_');
};

// Event Data
const eventData = getAllEventData();

// context
let context = {};
context.ip = eventData['x-ttq-ct-ip-address'] || eventData.ip_override || getRemoteAddress();
context.user_agent = eventData['x-ttq-ct-user-agent'] || eventData.user_agent;

// context > page
context.page = {};
context.page.url = eventData['x-ttq-ct-page-url'] || eventData.page_location;
context.page.referrer = eventData['x-ttq-ct-page-referer'] || eventData.page_referrer;

// context > ad
const ttclidCookie = getCookieValues('ttclid')[0];
const ttclid = eventData['x-ttq-ttclid']|| getTtclidFromUrl(context.page.url);
if (ttclid) {
  context.ad = {};
  context.ad.callback = ttclid;
  setCookie('ttclid', ttclid, {
      'max-age': 3600 * 24 * 7,
      domain: 'auto',
      path: '/',
      httpOnly: true,
      secure: true,
    });
}

// context > user
const ga4UserProperties = eventData['x-ga-mp2-user_properties'] || eventData.user_properties || {};
const external_id = eventData['x-ttq-ud-external-id'] || eventData.user_id || ga4UserProperties.id;
const email = eventData['x-ttq-ud-email'] || ga4UserProperties.email;
const phone_number = eventData['x-ttq-ud-phone-number'] || ga4UserProperties.phone_number;
context.user = {};
context.user.external_id = hashSHA256(external_id);
context.user.email = hashSHA256(email);
context.user.phone_number = hashSHA256(phone_number);

// properties
let properties = {};
const contents = eventData.items || [];
properties.contents = eventData['x-ttq-pt-contents'] || getTtqContentsFromItems(contents);
properties.currency = eventData['x-ttq-pt-currency'] || eventData.currency;
properties.value = eventData['x-ttq-pt-value'] || eventData.value || getValueFromItems(contents);
properties.description = eventData['x-ttq-pt-description'];
properties.query = eventData['x-ttq-pt-query'] || eventData.search_term;

// Post Data
let postData = {};
postData.pixel_code = data.pixelCode;
postData.event = getEventName(eventData['x-ttq-event-name'] || eventData.event_name);
postData.timestamp = eventData['x-ttq-timestamp'] || eventData.timestamp || makeString(makeInteger(getTimestampMillis() / 1000));
postData.event_id = eventData['x-ttq-event-id'] || eventData.transaction_id || eventData.event_id || generateGA4EventId(eventData);
postData.context = context;
postData.properties = properties;

// TikTok API Settings
const apiVersion = 'v1.3';
const postUrl = 'https://business-api.tiktok.com/open_api/'+apiVersion+'/pixel/track/';

// Send Event to TikTok
sendHttpRequest(postUrl, (statusCode, headers, response) => {
  if (statusCode >= 200 && statusCode < 300) { 
    data.gtmOnSuccess();
    return;
  }
  data.gtmOnFailure();
  return;
}, {headers: {"access-token": data.accessToken, "content-type": 'application/json'}, method: 'POST'}, JSON.stringify(postData));


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ttclid"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ttclid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "/"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 2021-12-15 23:01:39


